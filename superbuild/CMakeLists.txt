cmake_minimum_required(VERSION 3.14)
project(MyAppSuperbuild)

include(ExternalProject)

set(SUPERBUILD_INSTALL_DIR ${CMAKE_BINARY_DIR}/install CACHE PATH "Install path for all components")

set(CMAKE_ARGS_COMMON
  -DCMAKE_INSTALL_PREFIX=<INSTALL_DIR>
  -DCMAKE_PREFIX_PATH=${SUPERBUILD_INSTALL_DIR}
  -DCMAKE_BUILD_TYPE=Release
)

ExternalProject_Add(MyLibUtils
  SOURCE_DIR ${CMAKE_SOURCE_DIR}/../MyLibUtils
  CMAKE_ARGS ${CMAKE_ARGS_COMMON}
  INSTALL_DIR ${SUPERBUILD_INSTALL_DIR}
  BUILD_ALWAYS 1
)

ExternalProject_Add(MyLibA
  SOURCE_DIR ${CMAKE_SOURCE_DIR}/../MyLibA
  CMAKE_ARGS ${CMAKE_ARGS_COMMON}
  INSTALL_DIR ${SUPERBUILD_INSTALL_DIR}
  DEPENDS MyLibUtils
  BUILD_ALWAYS 1
)

ExternalProject_Add(MyApp
  SOURCE_DIR ${CMAKE_SOURCE_DIR}/../MyApp
  CMAKE_ARGS ${CMAKE_ARGS_COMMON}
  INSTALL_DIR ${SUPERBUILD_INSTALL_DIR}
  DEPENDS MyLibA
  BUILD_ALWAYS 1
)
